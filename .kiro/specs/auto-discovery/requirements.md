# 需求文档 - 自动项目发现功能

## 简介

本文档规定了在代码变更影响分析系统中实现自动项目发现功能的需求。该功能将使系统能够自动发现 Git 组织下的所有项目，并自动分析它们之间的依赖关系，无需手动配置项目关联。

## 术语表

- **Git 组织（Git Organization）**: Git 服务器上的组织或群组，包含多个项目仓库
- **自动发现（Auto Discovery）**: 系统自动扫描 Git 组织并识别所有项目的过程
- **依赖分析（Dependency Analysis）**: 通过静态代码分析自动识别项目间依赖关系的过程
- **项目组（Project Group）**: 一组相关的项目，可以一起进行跨项目分析
- **Git API**: Git 服务器提供的 API 接口，用于查询组织和项目信息

## 需求

### 需求 1

**用户故事：** 作为系统管理员，我希望配置 Git 组织信息，以便系统知道从哪里自动发现项目。

#### 验收标准

1. WHEN 用户创建 Git 组织配置 THEN 系统 SHALL 存储组织名称、Git 服务器地址、认证信息和默认分支
2. WHEN 用户查询 Git 组织配置 THEN 系统 SHALL 返回所有已配置的组织
3. WHEN 用户更新 Git 组织配置 THEN 系统 SHALL 更新配置并持久化更改
4. WHEN 用户删除 Git 组织配置 THEN 系统 SHALL 从数据库中删除该配置
5. THE 系统 SHALL 对 Git 服务器地址和组织名称的组合强制执行唯一性约束

### 需求 2

**用户故事：** 作为开发人员，我希望系统自动发现 Git 组织下的所有项目，以便我不需要手动添加每个项目。

#### 验收标准

1. WHEN 用户触发自动发现 THEN 系统 SHALL 使用 Git API 查询组织下的所有项目
2. WHEN 发现新项目 THEN 系统 SHALL 将项目信息存储到数据库
3. WHEN 项目已存在 THEN 系统 SHALL 更新项目信息而不是创建重复记录
4. WHEN 自动发现完成 THEN 系统 SHALL 返回发现的项目数量和更新的项目数量
5. IF Git API 调用失败 THEN 系统 SHALL 记录错误并向用户显示明确的错误消息

### 需求 3

**用户故事：** 作为开发人员，我希望系统自动分析项目间的依赖关系，以便我知道哪些项目相互依赖。

#### 验收标准

1. WHEN 触发依赖分析 THEN 系统 SHALL 克隆或更新所有发现的项目
2. WHEN 分析项目依赖 THEN 系统 SHALL 扫描代码中的 API 调用和类引用
3. WHEN 发现项目间依赖 THEN 系统 SHALL 自动创建项目关联记录
4. WHEN 依赖关系不再存在 THEN 系统 SHALL 标记该关联为非活动状态
5. THE 系统 SHALL 支持 Java、JavaScript 和 TypeScript 项目的依赖分析

### 需求 4

**用户故事：** 作为开发人员，我希望在触发分析时自动使用发现的项目关系，以便我不需要手动选择关联项目。

#### 验收标准

1. WHEN 启用跨项目分析 THEN 系统 SHALL 自动查询主项目的所有依赖项目
2. WHEN 主项目属于某个 Git 组织 THEN 系统 SHALL 使用该组织的自动发现结果
3. WHEN 分析任务执行 THEN 系统 SHALL 包含所有自动发现的依赖项目
4. WHEN 显示分析配置 THEN 系统 SHALL 显示将要扫描的自动发现项目列表
5. THE 系统 SHALL 允许用户临时排除某些自动发现的项目

### 需求 5

**用户故事：** 作为系统管理员，我希望定期自动更新项目发现和依赖分析，以便系统始终保持最新状态。

#### 验收标准

1. WHEN 配置自动更新计划 THEN 系统 SHALL 存储更新频率和执行时间
2. WHEN 到达计划执行时间 THEN 系统 SHALL 自动触发项目发现和依赖分析
3. WHEN 自动更新执行 THEN 系统 SHALL 记录执行日志和结果
4. WHEN 自动更新失败 THEN 系统 SHALL 发送通知给管理员
5. THE 系统 SHALL 支持按小时、天或周配置更新频率

### 需求 6

**用户故事：** 作为开发人员，我希望查看自动发现的项目和依赖关系图，以便我了解整个系统的架构。

#### 验收标准

1. WHEN 用户访问项目发现页面 THEN 系统 SHALL 显示所有自动发现的项目列表
2. WHEN 用户查看项目详情 THEN 系统 SHALL 显示该项目的所有依赖和被依赖关系
3. WHEN 用户查看依赖关系图 THEN 系统 SHALL 以可视化方式展示项目间的依赖关系
4. WHEN 用户点击项目节点 THEN 系统 SHALL 显示该项目的详细信息
5. THE 系统 SHALL 支持按项目名称、语言或依赖数量过滤和排序

### 需求 7

**用户故事：** 作为系统管理员，我希望系统支持多种 Git 服务器，以便我可以从不同的 Git 平台自动发现项目。

#### 验收标准

1. THE 系统 SHALL 支持 GitLab API 进行项目发现
2. THE 系统 SHALL 支持 GitHub API 进行项目发现
3. THE 系统 SHALL 支持 Gitea API 进行项目发现
4. WHEN 配置 Git 组织 THEN 系统 SHALL 允许用户选择 Git 服务器类型
5. THE 系统 SHALL 提供统一的接口以支持添加新的 Git 服务器类型

### 需求 8

**用户故事：** 作为开发人员，我希望系统智能识别项目类型和技术栈，以便系统可以使用正确的分析方法。

#### 验收标准

1. WHEN 发现新项目 THEN 系统 SHALL 自动识别项目的编程语言
2. WHEN 识别项目类型 THEN 系统 SHALL 检测项目是前端、后端还是全栈项目
3. WHEN 识别技术栈 THEN 系统 SHALL 检测使用的框架（如 Spring Boot、React 等）
4. WHEN 项目信息更新 THEN 系统 SHALL 存储识别的项目类型和技术栈信息
5. THE 系统 SHALL 根据项目类型选择合适的依赖分析策略

### 需求 9

**用户故事：** 作为开发人员，我希望系统提供手动触发和自动触发两种模式，以便我可以灵活控制项目发现的时机。

#### 验收标准

1. WHEN 用户手动触发项目发现 THEN 系统 SHALL 立即执行发现和分析
2. WHEN 用户启用自动模式 THEN 系统 SHALL 按配置的计划自动执行
3. WHEN 用户禁用自动模式 THEN 系统 SHALL 停止自动执行但保留配置
4. WHEN 显示执行历史 THEN 系统 SHALL 区分手动触发和自动触发的记录
5. THE 系统 SHALL 允许用户查看每次执行的详细日志和结果

### 需求 10

**用户故事：** 作为系统架构师，我希望自动发现功能是可扩展的，以便将来可以添加更多的发现策略和分析方法。

#### 验收标准

1. THE 系统 SHALL 实现一个 GitProviderInterface 接口来抽象不同的 Git 服务器
2. THE 系统 SHALL 实现一个 DependencyAnalyzer 接口来抽象不同的依赖分析策略
3. WHEN 添加新的 Git 服务器支持 THEN 系统 SHALL 允许插入新的 GitProvider 实现
4. WHEN 添加新的分析策略 THEN 系统 SHALL 允许插入新的 DependencyAnalyzer 实现
5. THE 系统 SHALL 在项目发现、依赖分析和结果存储之间分离关注点
